<!-- chat_elements.html - Copy and include this HTML structure in your pages -->

<!-- Overlay for blur effect (initially hidden) -->
<div id="overlay" class="fixed inset-0 bg-black bg-opacity-40 backdrop-blur-sm z-40 hidden"></div>

<!-- Customer Service Floating Button -->
<div class="fixed bottom-6 right-6 z-50">
    <!-- Main Button -->
    <button id="cs-button" class="bg-yellow-600 text-black rounded-full w-14 h-14 flex items-center justify-center shadow-lg hover:shadow-xl transition-all duration-300">
        <i class="fas fa-comments text-xl"></i>
    </button>

    <!-- Chat Window Modal (Initially Hidden) -->
    <div id="chat-window" class="fixed bottom-12 right-6 md:right-20 z-50 bg-white rounded-lg shadow-xl w-[90vw] max-w-sm md:w-96 hidden">
        <!-- Chat Header -->
        <div class="bg-black text-white p-3 rounded-t-lg flex justify-between items-center">
            <div class="flex items-center">
                <div class="w-2 h-2 bg-green-500 rounded-full mr-2"></div>
                <span class="text-sm md:text-base">Customer Support</span>
            </div>
            <div class="flex space-x-2">
                <button id="minimize-chat" class="hover:text-gray-300 transition">
                    <i class="fas fa-minus text-xs"></i>
                </button>
                <button id="close-chat" class="hover:text-gray-300 transition">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>

        <!-- Add this right after the chat window div -->
        <input type="hidden" id="user-id" value="<?php echo isset($_SESSION['user_id']) ? $_SESSION['user_id'] : ''; ?>">

        <!-- Chat Messages -->
        <div id="chat-messages" class="p-3 h-64 md:h-80 overflow-y-auto space-y-3 bg-gray-50">
            <div class="flex items-start">
                <div class="bg-gray-200 rounded-lg p-2 max-w-[80%]">
                    <p class="text-sm">Hello, welcome to GrievEase customer support. How can I assist you today?</p>
                </div>
            </div>
        </div>

        <!-- Chat Input -->
        <div class="p-3 border-t">
            <div class="flex">
                <input type="text" id="chat-input" placeholder="Type your message..." class="flex-1 p-2 border border-gray-300 rounded-l-md focus:outline-none focus:border-gold text-sm md:text-base">
                <button id="send-message" class="bg-yellow-600 text-black px-3 md:px-4 rounded-r-md hover:bg-darkgold transition">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Branch Selection Modal (Initially Hidden) -->
<div id="branch-modal" class="fixed inset-0 flex items-center justify-center z-50 hidden">
    <div class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm"></div>
    <div class="bg-white rounded-lg shadow-xl w-[90vw] max-w-xs md:max-w-sm z-10 p-4 md:p-5 mx-4">
        <h3 class="text-base md:text-lg font-semibold mb-3 md:mb-4">Select Branch Location</h3>
        <p class="text-xs md:text-sm text-gray-600 mb-3 md:mb-4">Please select which branch you'd like to contact:</p>

        <div id="branch-options" class="space-y-2 md:space-y-3">
            <!-- Branch options will be dynamically inserted here -->
            <div class="text-center py-3 md:py-4">
                <i class="fas fa-spinner fa-spin"></i> Loading branches...
            </div>
        </div>
    </div>
</div>

<!-- Add responsive styles -->
<style>
    @media (max-height: 640px) {
        #chat-window {
            bottom: 0;
            right: 0;
            width: 100%;
            max-width: 100%;
            height: 100vh;
            border-radius: 0;
        }
        
        #chat-messages {
            height: calc(100vh - 120px);
        }
    }
    
    @media (max-width: 640px) {
        #cs-button {
            width: 50px;
            height: 50px;
            bottom: 16px;
            right: 16px;
        }
    }
</style>

<!-- Add this script to handle mobile/landscape view -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const csButton = document.getElementById('cs-button');
    const chatWindow = document.getElementById('chat-window');
    
    // Function to check if in mobile view
    function isMobileView() {
        return window.innerWidth < 640 || window.innerHeight < 640;
    }
    
    // Function to adjust chat window position
    function adjustChatWindow() {
        if (isMobileView() && chatWindow.classList.contains('block')) {
            chatWindow.classList.add('fixed', 'inset-0', 'm-0');
            chatWindow.style.maxWidth = '100%';
            chatWindow.style.width = '100%';
            chatWindow.style.height = '100%';
            chatWindow.style.borderRadius = '0';
        } else {
            chatWindow.classList.remove('fixed', 'inset-0', 'm-0');
            chatWindow.style.maxWidth = '';
            chatWindow.style.width = '';
            chatWindow.style.height = '';
            chatWindow.style.borderRadius = '';
        }
    }
    
    // Add resize event listener
    window.addEventListener('resize', adjustChatWindow);
    
    // Modify existing click handler for CS button
    const originalClickHandler = csButton.onclick;
    csButton.onclick = function(e) {
        if (originalClickHandler) {
            originalClickHandler.call(this, e);
        }
        
        // Apply mobile adjustments after toggling visibility
        setTimeout(adjustChatWindow, 0);
    };
});
</script>