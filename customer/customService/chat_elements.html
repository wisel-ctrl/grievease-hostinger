<!-- Overlay for blur effect (initially hidden) -->
<div id="overlay" class="fixed inset-0 bg-black bg-opacity-40 backdrop-blur-sm z-40 hidden"></div>

<!-- Customer Service Floating Button -->
<div class="fixed bottom-6 right-6 z-50">
    <!-- Main Button -->
    <button id="cs-button" class="bg-yellow-600 text-black rounded-full w-14 h-14 flex items-center justify-center shadow-lg hover:shadow-xl transition-all duration-300">
        <i class="fas fa-comments text-xl"></i>
    </button>

    <!-- Chat Window Modal (Initially Hidden) -->
    <div id="chat-window" class="fixed bottom-0 right-0 md:bottom-12 md:right-20 z-50 bg-white rounded-lg shadow-xl w-full md:w-80 h-full md:h-auto max-h-screen md:max-h-96 hidden">
        <!-- Chat Header -->
        <div class="bg-black text-white p-3 rounded-t-lg flex justify-between items-center sticky top-0">
            <div class="flex items-center">
                <div class="w-2 h-2 bg-green-500 rounded-full mr-2"></div>
                <span>Customer Support</span>
            </div>
            <div class="flex space-x-2">
                <button id="minimize-chat" class="hover:text-gray-300 transition">
                    <i class="fas fa-minus text-xs"></i>
                </button>
                <button id="close-chat" class="hover:text-gray-300 transition">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>

        <!-- Add this right after the chat window div -->
        <input type="hidden" id="user-id" value="<?php echo isset($_SESSION['user_id']) ? $_SESSION['user_id'] : ''; ?>">

        <!-- Chat Messages -->
        <div id="chat-messages" class="p-3 h-80 overflow-y-auto space-y-3 bg-gray-50 flex-grow">
            <div class="flex items-start">
                <div class="bg-gray-200 rounded-lg p-2 max-w-[80%]">
                    <p class="text-sm">Hello, welcome to GrievEase customer support. How can I assist you today?</p>
                </div>
            </div>
        </div>

        <!-- Chat Input -->
        <div class="p-3 border-t sticky bottom-0 bg-white">
            <div class="flex">
                <input type="text" id="chat-input" placeholder="Type your message..." class="flex-1 p-2 border border-gray-300 rounded-l-md focus:outline-none focus:border-gold">
                <button id="send-message" class="bg-yellow-600 text-black px-4 rounded-r-md hover:bg-darkgold transition">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Branch Selection Modal (Initially Hidden) -->
<div id="branch-modal" class="fixed inset-0 flex items-center justify-center z-50 hidden">
    <div class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm"></div>
    <div class="bg-white rounded-lg shadow-xl w-full max-w-xs md:max-w-sm mx-4 z-10 p-5">
        <h3 class="text-lg font-semibold mb-4">Select Branch Location</h3>
        <p class="text-sm text-gray-600 mb-4">Please select which branch you'd like to contact:</p>

        <div id="branch-options" class="space-y-3 max-h-60 overflow-y-auto">
            <!-- Branch options will be dynamically inserted here -->
            <div class="text-center py-4">
                <i class="fas fa-spinner fa-spin"></i> Loading branches...
            </div>
        </div>
    </div>
</div>

<!-- Add responsive CSS for mobile devices -->
<style>
    @media (max-width: 768px) {
        #chat-window {
            transition: all 0.3s ease;
        }
        #chat-window.active {
            display: flex !important;
            flex-direction: column;
        }
        #chat-messages {
            height: calc(100vh - 120px);
        }
    }
</style>

<!-- Add JavaScript to handle responsive behavior -->
<script>
    // Original chat functionality remains unchanged
    document.addEventListener('DOMContentLoaded', function() {
        const csButton = document.getElementById('cs-button');
        const chatWindow = document.getElementById('chat-window');
        const minimizeChat = document.getElementById('minimize-chat');
        const closeChat = document.getElementById('close-chat');
        const overlay = document.getElementById('overlay');
        
        // Responsive handling
        function toggleChat() {
            chatWindow.classList.toggle('hidden');
            chatWindow.classList.toggle('active');
            
            // On mobile, show overlay when chat is open
            if (window.innerWidth < 768) {
                if (!chatWindow.classList.contains('hidden')) {
                    overlay.classList.remove('hidden');
                } else {
                    overlay.classList.add('hidden');
                }
            }
        }
        
        csButton.addEventListener('click', toggleChat);
        closeChat.addEventListener('click', toggleChat);
        minimizeChat.addEventListener('click', toggleChat);
        
        // Close chat when clicking overlay (mobile only)
        overlay.addEventListener('click', function() {
            chatWindow.classList.add('hidden');
            chatWindow.classList.remove('active');
            overlay.classList.add('hidden');
        });
        
        // Adjust on window resize
        window.addEventListener('resize', function() {
            if (window.innerWidth >= 768) {
                overlay.classList.add('hidden');
                chatWindow.style.height = '';
            }
        });
    });
</script>